apiVersion: v1
kind: Pod
metadata:
  name: "{{ include "liferay-helm.fullname" . }}-test-connection"
  labels:
    {{- include "liferay-helm.labels" . | nindent 4 }}
  annotations:
    "helm.sh/hook": test
spec:
  containers:
    - name: test-connection
      image: busybox:latest
      command: ["/bin/sh","-c"]
      args:
        - |
          trap 'echo "Received signal to Terminate"; exit 0' SIGINT SIGTERM

          until nc -vz -w 2 {{ include "liferay-helm.fullname" . }} {{ .Values.service.port }}; do
            echo "Waiting for DXP service"
            sleep 2
          done
      serviceAccountName: {{ include "liferay-helm.serviceAccountName" . }}
  restartPolicy: Never
